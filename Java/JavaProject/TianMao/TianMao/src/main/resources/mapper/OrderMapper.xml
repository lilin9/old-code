<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tianmao.mapper.OrderMapper">
    <resultMap id="OrderEntityMapper" type="com.tianmao.pojo.Order">
        <!--在定义映射规则时主键不可省略-->
        <result property="oid" column="oid" />
        <result property="recvName" column="recv_name" />
        <result property="recvPhone" column="recv_phone" />
        <result property="recvProvince" column="recv_province" />
        <result property="recvCity" column="recv_city" />
        <result property="recvArea" column="recv_area" />
        <result property="recvAddress" column="recv_address" />
        <result property="totalPrice" column="total_price" />
        <result property="orderTime" column="order_time" />
        <result property="payTime" column="pay_time" />
        <result property="createdUser" column="created_user" />
        <result property="createdTime" column="created_time" />
        <result property="modifiedUser" column="modified_user" />
        <result property="modifiedTime" column="modified_time" />
    </resultMap>
    <!--Integer insertOrder(Order order);-->
    <insert id="insertOrder" useGeneratedKeys="true" keyProperty="oid">
        insert into
            t_order(uid,recv_name,recv_phone,recv_province,recv_city,recv_area,recv_address,
                    total_price,`status`,order_time,pay_time,created_user,created_time,modified_user,
                    modified_time)
        values
               (#{uid},#{recvName},#{recvPhone},#{recvProvince},#{recvCity},#{recvArea},#{recvAddress},
                #{totalPrice},#{status},#{orderTime},#{payTime},#{createdUser},#{createdTime},
                #{modifiedUser},#{modifiedTime})
    </insert>
    <!--Integer insertOrderItem(OrderItem orderItem);-->
    <insert id="insertOrderItem" useGeneratedKeys="true" keyProperty="id">
        insert into
            t_order_item(oid,pid,title,image,price,num,created_user,created_time,modified_user,
                         modified_time)
        values
               (#{oid},#{pid},#{title},#{image},#{price},#{num},#{createdUser},#{createdTime},
                #{modifiedUser},#{modifiedTime})
    </insert>
    <!--List<CartVo> selectCartVoByCids(Integer[] pids);-->
    <select id="selectCartVoByCids" resultType="com.tianmao.vo.CartVo">
        select
            pid,cid,uid,t_cart.num,t_cart.price,t_product.title,t_product.image,t_product.price as 	realPrice
        from
            t_cart
                left join
            t_product on t_product.id = t_cart.pid
        where
            pid in (
                <foreach collection="list" item="pid" separator=",">
                    #{pid}
                </foreach>
            )
        order by
            t_cart.created_time desc
    </select>
</mapper>