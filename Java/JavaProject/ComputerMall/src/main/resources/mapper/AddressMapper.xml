<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lilin.mapper.AddressMapper">

    <resultMap id="AddressEntityMapper" type="com.lilin.pojo.Address">
        <!--在定义映射规则时主键不可省略-->
        <result property="aid" column="aid" />
        <result property="provinceName" column="province_name" />
        <result property="provinceCode" column="province_code" />
        <result property="cityName" column="city_name" />
        <result property="cityCode" column="city_code" />
        <result property="areaName" column="area_name" />
        <result property="areaCode" column="area_code" />
        <result property="isDefault" column="is_default" />
        <result property="createdUser" column="created_user" />
        <result property="createdTime" column="created_time" />
        <result property="modifiedUser" column="modified_user" />
        <result property="modifiedUser" column="modified_time" />
    </resultMap>

    <!--Integer insert(Address address);-->
    <insert id="insert" useGeneratedKeys="true" keyProperty="aid">
        insert into
            t_address(uid,`name`,province_name,province_code,city_name,city_code,area_name,
                      area_code,zip,address,phone,tel,tag,is_default,created_user,created_time,
                      modified_user,modified_time)
        values
            (#{uid},#{name},#{provinceName},#{provinceCode},#{cityName},#{cityCode},#{areaName},
             #{areaCode},#{zip},#{address},#{phone},#{tel},#{tag},#{isDefault},#{createdUser},
             #{createdTime},#{modifiedUser},#{modifiedTime})
    </insert>
    <!--Integer updateAllAddressNonDefault(Integer uid);-->
    <update id="updateAllAddressNonDefault">
        update
            t_address
        set
            is_default=0
        where
              uid=#{uid}
    </update>
    <!--Integer updateAddressDefault(String modifiedUser, String modifiedTime, Integer aid);-->
    <update id="updateAddressDefault">
        update
            t_address
        set
            is_default=1,modified_user=#{modifiedUser},modified_time=#{modifiedTime}
        where
              aid=#{aid}
    </update>
    <!--Integer deleteAddressByAid(Integer aid);-->
    <delete id="deleteAddressByAid">
        delete from
                    t_address
        where
              aid=#{aid}
    </delete>
    <!--Integer countAddressByUid(Integer uid);-->
    <select id="countAddressByUid" resultType="java.lang.Integer">
        select
               count(*)
        from
             t_address
        where
              uid=#{uid}
    </select>
    <!--List<District> selectAddressByUid(Integer uid);-->
    <select id="selectAddressByUid" resultMap="AddressEntityMapper">
        select
               aid,uid,`name`,province_name,province_code,city_name,city_code,area_name,
               area_code,zip,address,phone,tel,tag,is_default,created_user,created_time,
               modified_user,modified_time
        from
             t_address
        where
              uid=#{uid}
        order by is_default desc,created_time desc
    </select>
    <!--Address selectDefaultAddress(Integer aid);-->
    <select id="selectDefaultAddressByAid" resultMap="AddressEntityMapper">
        select
            aid,uid,`name`,province_name,province_code,city_name,city_code,area_name,
            area_code,zip,address,phone,tel,tag,is_default,created_user,created_time,
            modified_user,modified_time
        from
             t_address
        where
              aid=#{aid}
    </select>
    <!--Address selectLastModifiedAddress(Integer uid);-->
    <select id="selectLastModifiedAddress" resultMap="AddressEntityMapper">
        select
            aid,uid,`name`,province_name,province_code,city_name,city_code,area_name,
            area_code,zip,address,phone,tel,tag,is_default,created_user,created_time,
            modified_user,modified_time
        from
             t_address
        where
              uid=#{uid}
        order by modified_time desc limit 0,1
    </select>
</mapper>